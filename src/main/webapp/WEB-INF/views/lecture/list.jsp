<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Í∞ïÏùò Î™©Î°ù - EduMate</title>
        <link rel="stylesheet" href="/resources/css/common/header.css">
        <link rel="stylesheet" href="/resources/css/common/footer.css">
        <link rel="stylesheet" href="/resources/css/lecture/list.css">
    </head>
    <body>
        <jsp:include page="../common/header.jsp" />
        <div class="main-container">
            <!-- Header Include -->
            <!-- Search Section -->
            <div class="search-section">
                <div class="search-title">
                    <span>üîç</span>
                    <span>Í∞ïÏùò Ï∞æÍ∏∞</span>
                </div>
                <div class="search-content">
                    <div class="search-left">
                        <div class="category-label">Ïπ¥ÌÖåÍ≥†Î¶¨</div>
                        <div class="category-container">
                            <div class="category-button <c:choose><c:when test='${category eq "Ï†ÑÏ≤¥"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>" onclick="selectCategory(this)">
                                <div class="category-text <c:choose><c:when test='${category eq "Ï†ÑÏ≤¥"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>">Ï†ÑÏ≤¥</div>
                            </div>
                            <div class="category-button <c:choose><c:when test='${category eq "ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>" onclick="selectCategory(this)">
                                <div class="category-text <c:choose><c:when test='${category eq "ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>">ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç</div>
                            </div>
                            <div class="category-button <c:choose><c:when test='${category eq "ÎîîÏûêÏù∏"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>" onclick="selectCategory(this)">
                                <div class="category-text <c:choose><c:when test='${category eq "ÎîîÏûêÏù∏"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>">ÎîîÏûêÏù∏</div>
                            </div>
                            <div class="category-button <c:choose><c:when test='${category eq "Îç∞Ïù¥ÌÑ∞Î∂ÑÏÑù"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>" onclick="selectCategory(this)">
                                <div class="category-text <c:choose><c:when test='${category eq "Îç∞Ïù¥ÌÑ∞Î∂ÑÏÑù"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>">Îç∞Ïù¥ÌÑ∞Î∂ÑÏÑù</div>
                            </div>
                            <div class="category-button <c:choose><c:when test='${category eq "ÎπÑÏ¶àÎãàÏä§"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>" onclick="selectCategory(this)">
                                <div class="category-text <c:choose><c:when test='${category eq "ÎπÑÏ¶àÎãàÏä§"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>">ÎπÑÏ¶àÎãàÏä§</div>
                            </div>
                            <div class="category-button <c:choose><c:when test='${category eq "Ïñ∏Ïñ¥"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>" onclick="selectCategory(this)">
                                <div class="category-text <c:choose><c:when test='${category eq "Ïñ∏Ïñ¥"}'>active</c:when><c:otherwise>inactive</c:otherwise></c:choose>">Ïñ∏Ïñ¥</div>
                            </div>
                        </div>
                    </div>
                    <div class="search-right">
                        <div class="course-count">Ï¥ù ${totalCount }Í∞ú Í∞ïÏùò</div>
                        <div class="sort-dropdown-container">
                            <div class="sort-dropdown" onclick="toggleSortDropdown()">
                                <span class="sort-selected">${sort}</span>
                                <div class="sort-arrow"></div>
                                <div class="sort-options">
                                    <div class="sort-option <c:if test='${sort eq "Ïù∏Í∏∞Ïàú"}'>selected</c:if>" onclick="selectSortOption(this, 'Ïù∏Í∏∞Ïàú')">Ïù∏Í∏∞Ïàú</div>
                                    <div class="sort-option <c:if test='${sort eq "ÏµúÏã†Ïàú"}'>selected</c:if>" onclick="selectSortOption(this, 'ÏµúÏã†Ïàú')">ÏµúÏã†Ïàú</div>
                                    <div class="sort-option <c:if test='${sort eq "Î≥ÑÏ†êÎÜíÏùÄÏàú"}'>selected</c:if>" onclick="selectSortOption(this, 'Î≥ÑÏ†êÎÜíÏùÄÏàú')">Î≥ÑÏ†êÎÜíÏùÄÏàú</div>
                                    <div class="sort-option <c:if test='${sort eq "ÎÇÆÏùÄÍ∞ÄÍ≤©Ïàú"}'>selected</c:if>" onclick="selectSortOption(this, 'ÎÇÆÏùÄÍ∞ÄÍ≤©Ïàú')">ÎÇÆÏùÄÍ∞ÄÍ≤©Ïàú</div>
                                    <div class="sort-option <c:if test='${sort eq "ÎÜíÏùÄÍ∞ÄÍ≤©Ïàú"}'>selected</c:if>" onclick="selectSortOption(this, 'ÎÜíÏùÄÍ∞ÄÍ≤©Ïàú')">ÎÜíÏùÄÍ∞ÄÍ≤©Ïàú</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Cards -->
            <div class="courses-container">
                <div class="courses-grid">
                    <c:forEach items="${lList }" var="lecture" varStatus="i">
                        <div class="course-card" onclick="location.href='/lecture/details?lectureNo=${lecture.lectureNo}'">
                            <img class="course-image" 
                                 src="${lecture.lecturePath}" 
                                 onerror="this.src='https://placehold.co/391x235'" 
                                 alt="Course"/>
                            <div class="course-info">
                                <h3 class="course-title">${lecture.lectureName }</h3>
                                <div class="course-meta">
                                    <div class="course-meta-left">
                                        <div class="instructor-name">${lecture.memberName } Í∞ïÏÇ¨</div>
                                    </div>
                                    <div class="course-meta-right">
                                        <span class="course-category">${lecture.lectureCategory }</span>
                                    </div>
                                </div>
                                <div class="course-bottom">
                                    <div class="course-rating">
                                        <span class="rating">‚òÖ ${lecture.lectureRating }</span>
                                        <span class="review-count">(${lecture.countReview })</span>
                                        <span class="student-count">üë§ ${lecture.countStudent }Î™Ö</span>
                                    </div>
                                    <div class="course-price">‚Ç© <fmt:formatNumber value="${lecture.lecturePrice}"
                                                                                  pattern="#,###"/></div>
                                </div>
                            </div>
                        </div>
                    </c:forEach>
                </div>
            </div>
            <!-- Pagination -->
            <div class="pagination-container">
                <c:if test="${startNavi ne 1 }">
                    <a href="/lecture/list?category=${category }&sort=${sort}&page=${startNavi - 1 }<c:if test='${not empty search}'>&search=${search}</c:if>" class="pagination-next-btn">
                        <div class="pagination-next">&laquo; Ïù¥Ï†Ñ</div>
                    </a>
                </c:if>
                <c:forEach begin="${startNavi }" end="${endNavi }" var="n">
                    <c:choose>
                        <c:when test="${currentPage eq n }">
                            <div class="pagination-current-btn">
                                <div class="pagination-current">${n }</div>
                            </div>
                        </c:when>
                        <c:otherwise>
                            <a href="/lecture/list?category=${category }&sort=${sort}&page=${n }<c:if test='${not empty search}'>&search=${search}</c:if>" class="pagination-number-btn">
                                <div class="pagination-number">${n }</div>
                            </a>
                        </c:otherwise>
                    </c:choose>
                </c:forEach>
                <c:if test="${endNavi ne maxPage }">
                    <a href="/lecture/list?category=${category }&sort=${sort}&page=${endNavi + 1 }<c:if test='${not empty search}'>&search=${search}</c:if>" class="pagination-next-btn">
                        <div class="pagination-next">Îã§Ïùå &raquo;</div>
                    </a>
                </c:if>
            </div>

        </div>
        
        <!-- Footer Include -->
        <jsp:include page="../common/footer.jsp" />

        <script>
            function toggleSortDropdown() {
                const dropdown = document.querySelector(".sort-dropdown");
                dropdown.classList.toggle("open");
            }

            function selectCategory(element) {
                // Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäºÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.querySelectorAll(".category-button").forEach((button) => {
                    button.classList.remove("active");
                    button.classList.add("inactive");
                });
                document.querySelectorAll(".category-text").forEach((text) => {
                    text.classList.remove("active");
                    text.classList.add("inactive");
                });

                // ÌÅ¥Î¶≠Îêú Î≤ÑÌäºÏùÑ activeÎ°ú ÏÑ§Ï†ï
                element.classList.remove("inactive");
                element.classList.add("active");
                const text = element.querySelector(".category-text");
                text.classList.remove("inactive");
                text.classList.add("active");
                const category = text.textContent;

                // ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ Î°úÍ∑∏
                const currentSort = "${sort}"
                const currentSearch = "${search}"
                let url = "/lecture/list?category=" + category + "&sort=" + currentSort;
                if (currentSearch) {
                    url += "&search=" + encodeURIComponent(currentSearch);
                }
                window.location.href = url;
            }

            function selectSortOption(element, value) {
                // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ï†úÍ±∞
                document.querySelectorAll(".sort-option").forEach((option) => {
                    option.classList.remove("selected");
                });

                // ÏÉàÎ°úÏö¥ ÏÑ†ÌÉù ÌëúÏãú
                element.classList.add("selected");

                // ÏÑ†ÌÉùÎêú Í∞í ÏóÖÎç∞Ïù¥Ìä∏
                document.querySelector(".sort-selected").textContent = value;

                // ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
                document.querySelector(".sort-dropdown").classList.remove("open");

                // Ïó¨Í∏∞ÏÑú Ïã§Ï†ú Ï†ïÎ†¨ Î°úÏßÅÏùÑ Íµ¨ÌòÑÌï† Ïàò ÏûàÏäµÎãàÎã§
                console.log("ÏÑ†ÌÉùÎêú Ï†ïÎ†¨:", value);
                // ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ Î°úÍ∑∏
                const currentCategory = "${category}"
                const currentSearch = "${search}"
                let url = "/lecture/list?category=" + currentCategory + "&sort=" + value;
                if (currentSearch) {
                    url += "&search=" + encodeURIComponent(currentSearch);
                }
                window.location.href = url;
            }

            // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
            document.addEventListener("click", function (event) {
                const dropdown = document.querySelector(".sort-dropdown");
                if (!dropdown.contains(event.target)) {
                    dropdown.classList.remove("open");
                }
            });
        </script>
    </body>
</html>